# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

## Данные

### Интерфейс IProduct 
Описывает товары используемые в приложении

Поля:
- `id: string` - уникальный идентификатор товара
- `title: string` - название товара
- `description: string` - описание товара
- `image: string` - URL изображения товара
- `category: string` - категория товара
- `price: number | null` - цена товара

### Интерфейс ICustomer
Описывает покупателя

Поля:
- `paymentMethod: "card" | "cash" | null` - способ оплаты заказа
- `email: string` - email покупателя
- `phone: string` - номер телефона покупателя
- `address: string` - адрес доставки

### Интерфейс IGetProducts
Описывает ответ сервера на запрос товаров

Поля:
- `totalCount: number` -  количество товаров
- `items: IProduct[]` - массив товаров

### Интерфейс ICreateOrderRequest
Описывает запрос на создание заказа

Поля:
- `payment: "card" | "cash" | null` - способ оплаты заказа
- `email: string` - email покупателя
- `phone: string` - номер телефона покупателя
- `address: string` - адрес доставки
- `total: number` - итога сумма заказа
- `items: string[]` - массив id товаров

### Интерфейс ICreateOrderResponse
Описывает ответ сервера на запрос создания заказа

Поля:
- `id: string` - идентификатор заказа
- `total: number` - итогова сумма заказа` 

### Интерфейс IHeader
Описывает данные для отображения в шапке сайта

Поля:
- `counter: number` - количество товаров в корзине

### Интерфейс ICart
Описывает данные для отображения корзины

Поля:
- `items: HTMLElement[]` - массив элементов товаров в корзине
- `total: number` - общая стоимость товаров в корзине

### Интерфейс IGallery
Описывает данные для отображения галереи товаров

Поля:
- `items: HTMLElement[]` - массив элементов товаров в галерее

### Интерфейс IModal
Описывает данные для отображения модального окна

Поля:
- `content: HTMLElement` - содержимое модального окна

### Интерфейс IBaseCard
Описывает базовые данные для отображения карточки товара

Поля:
- `id: string` - идентификатор товара
- `title: string` - название товара
- `price: number | null` - цена товара

### Интерфейс IForm
Описывает данные для отображения формы

Поля:
- `error: string | null` - текст ошибки валидации

### Интерфейс ISuccess
Описывает данные для отображения сообщения об успешном оформлении заказа

Поля:
- `total: number` - сумма заказа

## Модели данных

### Класс Catalog
Содержит логику управления каталогом товаров

Конструктор класса не принимает параметров

Конструктор:  
`constructor(events: IEvents)` - принимает объект событий для генерации событий при изменении данных

Поля класса:
- `prodcuts: IProduct[]` - массив товаров в каталоге
- `selectedProduct: IProduct | null` - выбранная в каталоге карточка
- `events: IEvents` - объект событий для генерации событий

Методы:
- `setProductsList(products: IProduct[]): void` - сохраняет массив товаров полученный в параметрах метода
- `getProductsList(): IProduct[]` - возвращает массив всех товаров
- `getProductById(id: string): IProduct` - возвращает товар по его id
- `setSelectedProduct(selectedProduct: IProduct): void` - сохраняет товар для подробного отображения
- `getSelectedProduct(): IProduct | null` - возвращает товар для подробного отображения

### Класс Cart
Содержит логику управления корзиной товаров

Конструктор:  
`constructor(products: IProduct[], events: IEvents)` - принимает массив товаров и объект событий для генерации событий при изменении данных

Поля класса:
- `cartProdcuts: IProduct[]` - массив товаров, выбранных покупателем для покупки
- `events: IEvents` - объект событий для генерации событий

Методы:
- `getCartProducts(): IProduct[]` - возвращает массив товаров, которые находятся в корзине
- `addCartProduct(product: IProduct): void` - добавляет товар, который был получен в параметре, в массив корзины
- `deleteCartProduct(product: IProduct): void` - удаляет товар, который был получен в параметре, из массива корзины
- `clearCart(): void` - очищает корзину
- `getTotalPrice(): number` - возвращает стоимость всех товаров в корзине
- `getTotalCount(): number` - возвращает количество товаров в корзине
- `isInCart(id: string): boolean` - проверяет наличие товара в корзине по его id, полученному в параметр метода

### Класс Customer
Cодержит логику управления данными покупателя

Конструктор:  
`constructor(events: IEvents)` - принимает объект событий для генерации событий при изменении данных

Поля класса:
- `paymentMethod: "card" | "cash" | null` - способ оплаты заказа
- `email: string` - email покупателя
- `phone: string` - номер телефона покупателя
- `address: string` - адрес доставки
- `events: IEvents` - объект событий для генерации событий

Методы:
- `setEmail(email: string): void` - сохраняет email пользователя
- `setPhone(phone: string): void` - сохраняет номер телефона пользователя
- `setAddress(address: string): void` - сохраняет адрес доставки
- `setPaymentMethod(paymentMethod: "card" | "cash" | null): void` - сохраняет способ оплаты заказа
- `getCustomerData(): ICustomer` - возвращает все данные покупателя
- `clearCustomerData(): void` - очищает данные покупателя
- `validateCustomerData(value: string): boolean` - валидирует данные

## Слой коммуникации 

### Класс ApiLayer
Класс отвечает за получение данных с сервера и отправку данных на сервер

Конструктор:
- `constructor(api: IApi)` - принимает объект класса IApi

Поля:
- `api: IApi` — экземпляр класса IApi, предоставляемый из стартового набора

Методы:
- `getProducts(): Promise<IGetResponse>` - возвращает с сервера объект с массивом товаров
- `postOrder(orderData: IPostRequestData): Promise<IPostResponse>` - отправляtn на сервер данные о покупателе и выбранных товарах

## Компоненты представления

### Класс Header
Класс отвечает за отображение шапки сайта

Конструктор:
- `constructor(container: HTMLElement, events: IEvents)` - принимает контейнер для отображения шапки и объект событий

Поля:
- `_counter: HTMLElement` - элемент для отображения количества товаров в корзине
- `_basketButton: HTMLButtonElement` - кнопка открытия корзины
- `events: IEvents` - объект событий

Методы:
- `set counter(value: number)` - устанавливает значение количества товаров в корзине

### Класс Gallery
Класс отвечает за отображение каталога товаров

Конструктор:
- `constructor(container: HTMLElement)` - принимает контейнер для отображения каталога товаров

Поля:
- `_catalog: HTMLElement` - контейнер для отображения каталога товаров

Методы:
- `set items(items: HTMLElement[])` - устанавливает массив товаров для отображения

### Класс CartView
Класс отвечает за отображение корзины

Конструктор:
- `constructor(container: HTMLElement, events: IEvents)` - принимает контейнер для отображения корзины

Поля:
- `_productsList: HTMLElement` — контейнер для отображения корзины
- `_button: HTMLButtonElement` — кнопка оформления заказа
- `_totalPrice: HTMLElement` - элемент для отображения общей стоимости товаров в корзине   

Методы:
- `set productsList(items: HTMLElement[])` - устанавливает массив товаров для отображения в корзине
- `set totalPrice(value: number)` - устанавливает значение общей стоимости товаров в корзине

### Класс BaseCard
Базовый класс, который содержит общий функционал всех темпелейтов карточек

Конструктор: 
- `constructor(container: HTMLElement)` - принимает контейнер карточки

Поля:
- `_title: HTMLElement` - элемент для отображения заголовка товара
- `_price: HTMLElement` - элемент для отборажения цены товара

Методы:
- `set id(value: string)` - устанавливает идентификатор товара
- `set title(value: string)` - устанавливает заголовок товара 
- `set price(value: number | null)` - устанавливает цену товара (форматирует вывод)

### Класс CatalogCard
Класс отвечает за отображение карточки товара в каталоге, наследуется от класса Card

Конструктор: 
- `constructor(container: HTMLElement, events: IEvents)` - принимает контейнер карточки и объект событий

Поля:
- `_image: HTMLImageElement` - элемент для отображения изображения товара
- `_category: HTMLElement` - элемент для отображения категории товара
- `events: IEvents` - объект событий

Методы:
- `set image(value: string)` - устанавливает путь до картинки товара
- `set category(value: string)` - устанавливает категорию товара

### Класс PreviewCard
Класс отвечает за отображение карточки товара в превью, наследуется от класса Card

Конструктор: 
- `constructor(container: HTMLElement, events: IEvents)` - принимает контейнер карточки

Поля:
- `_image: HTMLImageElement` - элемент для отображения изображения товара
- `_category: HTMLElement` - элемент для отображения категории товара
- `_description: HTMLElement` - элемент для отображения описания товара
- `_button: HTMLButtonElement` - кнопка добавления товара в корзину
- `inCart: boolean` - флаг наличия товара в корзине
- `events: IEvents` - объект событий

Методы:
- `set image(value: string)` - устанавливает путь до картинки товара
- `set category(value: string)` - устанавливает категорию товара
- `set description(value: string)` - устанавливает описание товара
- `set isInCart(value: boolean)` - устанавливает флаг наличия товара в корзине
- `set buttonDisabled(value: boolean)` - устанавливает состояние кнопки добавления в корзину

### Класс CartCard
Класс отвечает за отображение карточки товара в корзине, наследуется от класса Card

Конструктор: 
- `constructor(container: HTMLElement, events: IEvents)` - принимает контейнер карточки

Поля:
- `_index: HTMLElement` - элемент для отображения индекса товара в корзине
- `_deleteButton: HTMLButtonElement` - кнопка удаления товара из корзины
- `events: IEvents` - объект событий

Методы:
- `set index(value: number)` - устанавливает индекс товара

### Класс Modal
Класс представляет собой самостоятельный компонент модального окна

Конструктор:
- `constructor(container: HTMLElement, events: IEvents)` - принимает контейнер модального окна и объект событий

Поля:
- `_closeButton: HTMLButtonElement` - кнопка закрытия модального окна
- `_content: HTMLElement` - контейнер для содержимого модального окна
- `events: IEvents` - объект событий
- `isOpen: boolean` - флаг состояния модального окна (открыто/закрыто)

Методы:
- `set content(value: HTMLElement)` - устанавливает содержимое модального окна
- `set isOpen(value: boolean)` - устанавливает состояние модального окна (открыто/закрыто)


### Класс Form
Базовый класс, который содержит общий функционал всех форм

Конструктор:
- `constructor(container: HTMLFormElement, events: IEvents)` - принимает контейнер формы и объект событий

Поля:
- `_submitButton: HTMLButtonElement` - кнопка отправки формы
- `_errors: HTMLElement` - элемент для отображения ошибки валидации
- `events: IEvents` - объект событий

Методы:
- `set errors(value: string)` - устанавливает текст ошибки при отправке формы
- `clear(): void` - очищает форму

### Класс OrderForm
Класс отвечает за отображение формы заказа для ввода способа и адреса доставки, наследуется от класса Form

Конструктор:
- `constructor(container: HTMLFormElement, events: IEvents)` - принимает контейнер формы и объект событий

Поля:
- `_paymentCard: HTMLButtonElement` - кнопка выбора оплаты картой
- `_paymentCash: HTMLButtonElement` - кнопка выбора оплаты наличными
- `_address: HTMLInputElement` - поле ввода адреса доставки
- `_nextBtn: HTMLButtonElement` - кнопка перехода к следующему шагу
- `_paymentMethod: 'card' | 'cash' | null` - выбранный способ оплаты
- `events: IEvents` - объект событий

Методы:
- `set address(value: string)` - устанавливает адрес доставки
- `set paymentMethod(value: 'card' | 'cash' | null)` - устанавливает способ оплаты
- `clear(): void` - очищает форму

### Класс ContactsForm
Класс отвечает за отображение формы заполнения контактов, наследуется от класса Form

Конструктор:
- `constructor(container: HTMLFormElement, events: IEvents)` - принимает контейнер формы и объект событий

Поля:
- `_email: HTMLInputElement` - поле ввода email
- `_phone: HTMLInputElement` - поле ввода телефона
- `_submitButton: HTMLButtonElement` - кнопка отправки формы
- `events: IEvents` - объект событий

Методы:
- `set email(value: string)` - устанавливает email
- `set phone(value: string)` - устанавливает телефон
- `clear(): void` - очищает форму

### Класс Success
Класс отвечает за отображение сообщения об успешном оформлении заказа

Конструктор:
- `constructor(container: HTMLElement, events: IEvents)` - принимает контейнер сообщения и объект событий

Поля:
- `_closeButton: HTMLButtonElement` - кнопка закрытия
- `_total: HTMLElement` - элемент для отображения суммы заказа
- `events: IEvents` - объект событий

Методы:
- `set total(value: number)` - устанавливает сумму списанных средств

## События 

- `cart:open` - событие открытия корзины. Срабатывает при клике на кнопку корзины в шапке сайта
- `cart:open-order` - событие перехода на страницу оформления заказа. Срабатывает при клике на кнопку Оформить в корзине
- `card:delete` - событие удаления товара из корзины. Срабатывает при клике на кнопку удаления товара в корзине
- `catalog:card-click` - событие открытия превью товара. Срабатывает при клике на карточку товара в каталоге
- `cardPreview:button-click` - событие добавления товара в корзину. Срабатывает при клике на кнопку добавления товара в превью
- `{formName}:submit` - событие отправки формы. Срабатывает при клике на кнопку отправки формы
- `payment:changed` - событие изменения способа оплаты. Срабатывает при изменении способа оплаты
- `address:changed` - событие изменения адреса доставки. Срабатывает при изменении адреса доставки
- `contacts:email-changed` - событие изменения email. Срабатывает при изменении email
- `contacts:phone-changed` - событие изменения телефона. Срабатывает при изменении телефона
- `modal:close` - событие закрытия модального окна. Срабатывает при клике на кнопку закрытия модального окна и при клике на область за пределами модального окна
- `success:close` - событие закрытия сообщения об успешном оформлении заказа. Срабатывает при клике на кнопку За новыми покупками

### Изменения моделей данных

- `cart:changed` - срабатывает при любом изменении корзины (добавление/удаление товаров, очистка)
- `catalog:changed` - срабатывает при изменении списка товаров
- `catalog:product-selected` - срабатывает при выборе товара
- `customer:changed` - срабатывает при изменении данных пользователя

# Презентер

Презентер — это слой приложения, который отвечает за логику работы с пользовательским интерфейсом. Он обрабатывает события от моделей данных и представлений, обновляет отображение и управляет логикой приложения.

## Основные принципы работы презентера

1. **Обработка событий**: Презентер подписывается на события, генерируемые моделями данных и представлениями. При возникновении события презентер выполняет соответствующую логику.
2. **Обновление отображения**: Презентер обновляет отображение только в двух случаях:
    - При обработке события от модели данных, говорящего о том, что данные изменились.
    - В результате обработки события открытия модального окна.
3. **Отсутствие генерации событий**: Презентер не генерирует события, он только обрабатывает их

## Логика работы

1. При запуске приложения презентер инициализирует модели данных и представления.
2. Презентер подписывается на все необходимые события.
3. При возникновении события презентер получает данные из модели, обновляет отображение и, при необходимости, изменяет состояние моделей данных